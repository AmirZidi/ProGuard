<!doctype html PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<title>Ant Task</title>
</head>
<body
 bgcolor="#ffffff"
 text="#000000">

<table width="100%" cellpadding="10" cellspacing="0"><tr><th bgcolor="#EEEEFF">
<font size="+2">Ant Task</font>
</th></tr></table>
<p>

<h3>Description</h3>

<p>
Run ProGuard as an Ant task. ProGuard is a free Java class file shrinker and
obfuscator.
</p>

<p>
The standard ProGuard application can be configured using command line options
or configuration files. The <code>proguard</code> task is an alternative for
configuring and running ProGuard by means of an Ant build file.
</p>

<p>
The task is designed to allow a smooth transition from ProGuard configuration
files to full XML Ant build files. This transition is discussed in the section
<a href="#migrating">Migrating from ProGuard configuration files to Ant build
files</a>.
</p>

<p>
Before you are able to use the <code>proguard</code> task, you have to tell
Ant about this new task. This is done through:
</p>

<code>
&lt;taskdef name="proguard" classname="proguard.ant.ProGuardTask" classpath="/usr/local/java/proguard/lib/proguard.jar" /&gt;
</code>

<p>
where you obviously have to replace the latter path by the path where you've
installed ProGuard.
</p>

<h3>Parameters</h3>

<table border="1" cellpadding="2" cellspacing="0">

  <tr>
    <td valign="top"><b>Attribute</b></td>
    <td valign="top"><b>Description</b></td>
    <td align="center" valign="top"><b>Required</b></td>
  </tr>
  <tr>
    <td valign="top"><a name="configuration"></a>configuration</td>
    <td valign="top">
        Name of a proguard configuration file.<br>
        The settings of the configuration file are merged with the ant settings.
        For single value attributes the ant settings override the settings
        of the config file.<br>
        The required values can also be set through the configuration file.
    </td>
    <td valign="top" align="center">No</td>
  </tr>
  <tr>
    <td valign="top">outjar</td>
    <td valign="top">
      Specifies the name of the output jar (or directory). It must be different
      from the input jars (and directories).
    </td>
    <td valign="top" align="center">Yes</td>
  </tr>
  <tr>
    <td valign="top">renamesourcefileattribute</td>
    <td valign="top">
     Specifies a constant string to be put in the SourceFile attributes of the
     class files. Note that the attribute also has to be preserved explicitly
     using the <a href="#keepattributes">keepattributes</a> directive, or it
     will be removed anyway.<br>
     For example, you may want to have your processed libraries and
     applications produce useful obfuscated stack traces. Only applicable
     when obfuscating.
    </td>
    <td valign="top" align="center">No</td>
  </tr>
  <tr>
    <td valign="top">printseeds</td>
    <td valign="top">
     Specifies to exhaustively list classes and class members matched by the
     various -keep commands. The list is printed to the standard output or to
     the given file. The list can be useful to verify if the intended class
      members are really found, especially if you're using wildcards.
      For example, you may want to list all the applications or all the applets
      that you are keeping.
    </td>
    <td valign="top" align="center">No</td>
  </tr>
  <tr>
    <td valign="top">printusage</td>
    <td valign="top">
     Specifies to list dead code of the input class files. The list is printed
     to the standard output or to the given file. For example, you can list
     the unused code of an application. Only applicable when shrinking.
    </td>
    <td valign="top" align="center">No</td>
  </tr>
  <tr>
    <td valign="top">printmapping</td>
    <td valign="top">
     Specifies to print the mapping from old names to new names for classes and
     class members that have been renamed. The mapping is printed to the
     standard output or to the given file. It is required if you ever want
     to make sense again of obfuscated stack traces.
     Only applicable when obfuscating.
    </td>
    <td valign="top" align="center">No</td>
  </tr>
  <tr>
    <td valign="top">verbose</td>
    <td valign="top">
     Specifies to write out some more information during processing. If the
     program terminates with an exception, this option will print out the
     entire stack trace, instead of just the exception message.<br>
     Defaults to <code>off</code>.
    </td>
    <td valign="top" align="center">No</td>
  </tr>
  <tr>
    <td valign="top">dump</td>
    <td valign="top">
     Specifies to write out the internal structure of the class files, after
     any processing. The structure is printed to the standard output or to the
     given file. For example, you may want to write out the contents of a given
     jar file, without shrinking or obfuscating it first.
    </td>
    <td valign="top" align="center">No</td>
  </tr>
  <tr>
    <td valign="top">ignorewarnings</td>
    <td valign="top">
     Specifies to print any warnings about unresolved references to
     superclasses, interfaces, or class members, but to continue processing in
     any case. If the classes or class members are indeed required for
     processing, the output jar will not function properly. Only use this
     option if you know what you're doing!<br>
     Defaults to <code>off</code>.
    </td>
    <td valign="top" align="center">No</td>
  </tr>
  <tr>
    <td valign="top">warn</td>
    <td valign="top">
     Specifies to warn about unresolved references at all. Again, if the
     unresolved classes or class members are indeed required for processing,
     the output jar will not function properly. Only use this option if you
     know what you're doing!<br>
     Defaults to <code>on</code>.
    </td>
    <td valign="top" align="center">No</td>
  </tr>
  <tr>
    <td valign="top">note</td>
    <td valign="top">
     Specifies to print notes about class casts of variable dynamically
     created objects. These notes provide hints about classes that may have to
     be kept.<br>
     Defaults to <code>on</code>.
    </td>
    <td valign="top" align="center">No</td>
  </tr>
  <tr>
    <td valign="top">shrink</td>
    <td valign="top">
     Specifies to shrink the input class files. By default, shrinking is
     applied: all classes and class members are removed, except for the ones
     listed by the various -keep commands, and the ones they depend on,
     recursively.<br>
     Defaults to <code>on</code>.
    </td>
    <td valign="top" align="center">No</td>
  </tr>
  <tr>
    <td valign="top">obfuscate</td>
    <td valign="top">
     Specifies to obfuscate the input class files. By default, obfuscation is
     applied: classes and class members receive new short random names, except
     for the ones listed by the various -keep commands. Internal attributes
     that are useful for debugging, such as source files names, variable
     names, and line numbers are removed.<br>
     Defaults to <code>on</code>.
    </td>
    <td valign="top" align="center">No</td>
  </tr>
  <tr>
    <td valign="top">usemixedclassnames</td>
    <td valign="top">
     Specifies to generate mixed-case class names while obfuscating. By default,
     obfuscated class names can contain a mix of upper-case characters and
     lower-case characters. This creates perfectly acceptable and usable jars.
     Only if a jar is unpacked on a platform with a case-insensitive filing
     system (say, Windows), the unpacking tool may let similarly named class
     files overwrite each other. Code that self-destructs when it's unpacked!
     Developers who really want to unpack their jars on Windows and who are
     unable to switch to another development platform can use this option to
     switch off this behavior. Note that the obfuscated jars will become larger
     as a result. Only applicable when obfuscating.<br>
     Defaults to <code>on</code>.
    </td>
    <td valign="top" align="center">No</td>
  </tr>
  <tr>
    <td valign="top">overloadaggressively</td>
    <td valign="top">
     Specifies to apply aggressive overloading while obfuscating. Multiple
     fields and methods can then get the same names, as long as their arguments
     and return types are different (not just their arguments, in the case of
     methods). This option can make the output jar even smaller (and less
     comprehensible). Only applicable when obfuscating.<br>
     Defaults to <code>off</code>.
    </td>
    <td valign="top" align="center">No</td>
  </tr>
  <tr>
    <td valign="top">defaultpackage</td>
    <td valign="top">
     Specifies to repackage all class files that are renamed into the single
     given package. Without argument or with an empty string (''), the package
     is removed completely. This option can make the output jar even smaller
     (and less comprehensible). Only applicable when obfuscating.
    </td>
    <td valign="top" align="center">No</td>
  </tr>
  <tr>
    <td valign="top">skipnonpubliclibraryclasses</td>
    <td valign="top">
     Specifies to ignore non-public library classes. By default, non-public
     library classes are skipped while parsing library jars. The classes are
     typically not relevant during processing, since they don't affect the
     actual program code in the input jars. Ignoring them reduces memory usage
     and processing time. Occasionally, a badly designed library may contain a
     non-public library class that is extended/implemented by a public library
     class. If the latter library class in turn is extended/implemented by a
     program class, ProGuard will complain that it can't find the non-public
     library class, which it had ignored during parsing. This option will
     overcome that problem, at the cost of greater memory usage and longer
     processing time.<br>
     Defaults to <code>on</code>.
    </td>
    <td valign="top" align="center">No</td>
  </tr>
</table>

<h3>Parameters specified as nested elements</h3>

<h3>libaryjar</h3>

<p>
Specifies the library jars (or directories) of the application to be processed.
The class files in these jars will not be included in the output jar.
The specified library jars should at least contain the class files that
are extended by application class files. Library class files that are only
called needn't be present.
</p>

<h3>Parameters</h3>

<table border="1" cellpadding="2" cellspacing="0">
  <tr>
    <td valign="top"><b>Attribute</b></td>
    <td valign="top"><b>Description</b></td>
    <td align="center" valign="top"><b>Required</b></td>
  </tr>

  <tr>
    <td valign="top">name</td>
    <td valign="top">
       Name of the library jar or name of a directory.<br>
       Jar files can be specified via a nested fileset, too. Note that
       this does not work for files in a directory.
    </td>
    <td valign="top" align="center">Yes</td>
  </tr>
  <tr>
    <td valign="top">refid</td>
    <td valign="top">
       Reference to a path like structure. Using a refid excludes specifying
       a name.
    </td>
    <td valign="top" align="center">No</td>
  </tr>
</table>

<h4>reourcejar</h4>

<p>
Specifies any resource jars (or directories) to be copied into the output
jar. Only non-class files in these jars will be copied.
If this option isn't specified, the resource
files from the <a href="#injar">injar</a> (or directories) will be copied.
</p>


<h3>Parameters</h3>

<table border="1" cellpadding="2" cellspacing="0">
  <tr>
    <td valign="top"><b>Attribute</b></td>
    <td valign="top"><b>Description</b></td>
    <td align="center" valign="top"><b>Required</b></td>
  </tr>

  <tr>
    <td valign="top">name</td>
    <td valign="top">
       Name of the jar or name of a directory.<br>
       Jar files can be specified via a nested fileset, too. Note that
       this does not work for files in a directory.
    </td>
    <td valign="top" align="center">Yes</td>
  </tr>
  <tr>
    <td valign="top">refid</td>
    <td valign="top">
       Reference to a path like structure. Using a refid excludes specifying
       a name.
    </td>
    <td valign="top" align="center">No</td>
  </tr>
</table>

<a name="injar"></a>
<h4>injar</h4>

<p>
Specifies the program jars (or directories) of the application to be processed.
The class files in these jars will be processed and merged in the output jar.
</p>


<h3>Parameters</h3>

<table border="1" cellpadding="2" cellspacing="0">
  <tr>
    <td valign="top"><b>Attribute</b></td>
    <td valign="top"><b>Description</b></td>
    <td align="center" valign="top"><b>Required</b></td>
  </tr>

  <tr>
    <td valign="top">name</td>
    <td valign="top">
       Name of the jar or directory.<br>
       Jar files can be specified via a nested fileset, too. Note that
       this does not work for files in a directory.
    </td>
    <td valign="top" align="center">Yes</td>
  </tr>
  <tr>
    <td valign="top">refid</td>
    <td valign="top">
       Reference to a path like structure. Using a refid excludes specifying
       a name.
    </td>
    <td valign="top" align="center">No</td>
  </tr>
</table>

<a name="keep"></a>
<h3>keep</h3>

<p>
Specifies classes and class members (fields and methods) to be preserved.
They will be preserved with their original names. This is typically the
required seed for recursively determining which other classes and class
members need to be preserved. For example, in order to keep an application,
you can specify the main class along with its main method. In order to process
a library, you should specify all publicly accessible items.
</p>


<h3>Parameters</h3>

<table border="1" cellpadding="2" cellspacing="0">
  <tr>
    <td valign="top"><b>Attribute</b></td>
    <td valign="top"><b>Description</b></td>
    <td align="center" valign="top"><b>Required</b></td>
  </tr>

  <tr>
    <td valign="top">access</td>
    <td valign="top">
      List of access flags to the class separated by a space. Must be one of
      <ul>
      <li>public</li>
      <li>final</li>
      <li>abstract</li>
      </ul>
      All access attributes may have a leading <code>!</code> to specify the
      attributes that are not set.
    </td>
    <td valign="top" align="center">No</td>
  </tr>
  <tr>
    <td valign="top">type</td>
    <td valign="top">
     Type of the class. Must be one of
      <ul>
      <li>class</li>
      <li>interface</li>
      <li>!interface</li>
      </ul>
      Defaults to <code>class</code>.
    </td>
    <td valign="top" align="center">No</td>
  </tr>
  <tr>
    <td valign="top">name</td>
    <td valign="top">
    Full name of the class. Wildcards are allowed. A description of the usage
    and limitations of wildcards can be found in
    <a href="usage.html#classspecification">ProGuard usage</a>.<br>
    Defaults to <code>*</code>
    </td>
    <td valign="top" align="center">No</td>
  </tr>
  <tr>
    <td valign="top">extends</td>
    <td valign="top">
    Full name of the class this class extends.
    </td>
    <td valign="top" align="center">No</td>
  </tr>
  <tr>
    <td valign="top">implements</td>
    <td valign="top">
    Full name of the interface this class implements.
    </td>
    <td valign="top" align="center">No</td>
  </tr>
</table>

<h3>Parameters specified as nested elements</h3>

<a name="accessTag"></a>
<h3>access</h3>

<p>
As an alternative to the access attribute it is possible to use the
nested access tag.
</p>


<h3>Parameters</h3>

<table border="1" cellpadding="2" cellspacing="0">
  <tr>
    <td valign="top"><b>Attribute</b></td>
    <td valign="top"><b>Description</b></td>
    <td align="center" valign="top"><b>Required</b></td>
  </tr>
  <tr>
    <td valign="top">name</td>
    <td valign="top">
    Name of the access attribute.
    </td>
    <td valign="top" align="center">Yes</td>
  </tr>
</table>

<h3>field</h3>

<p>
With the fields tag you can specify the fields to be kept.
</p>

<h3>Parameters</h3>

<table border="1" cellpadding="2" cellspacing="0">
  <tr>
    <td valign="top"><b>Attribute</b></td>
    <td valign="top"><b>Description</b></td>
    <td align="center" valign="top"><b>Required</b></td>
  </tr>
  <tr>
    <td valign="top">access</td>
    <td valign="top">
      List of access flags to the field, separated by spaces. Must be one of
      <ul>
      <li>public</li>
      <li>protected</li>
      <li>private</li>
      <li>static</li>
      <li>volatile</li>
      <li>transient</li>
      </ul>
      All access attributes may have a leading <code>!</code> to specify the
      attributes that are not set.<br>
      The access attributes may be set using the nested
      <a href="#accessTag">access tag</a>.
    </td>
    <td valign="top" align="center">No</td>
  </tr>
  <tr>
    <td valign="top">type</td>
    <td valign="top">
     Full name of the type of the field.
    </td>
    <td valign="top" align="center">No</td>
  </tr>
  <tr>
    <td valign="top">name</td>
    <td valign="top">
    Name of the field. Wildcards are allowed. A description of the usage
    and limitations of wildcards can be found in
    <a href="usage.html#classspecification">ProGuard usage</a>.<br>
    Defaults to <code>*</code>
    </td>
    <td valign="top" align="center">No</td>
  </tr>
</table>

<h3>method</h3>

<p>
With the method tag you can specify the methods to be kept.
</p>

<h3>Parameters</h3>

<table border="1" cellpadding="2" cellspacing="0">
  <tr>
    <td valign="top"><b>Attribute</b></td>
    <td valign="top"><b>Description</b></td>
    <td align="center" valign="top"><b>Required</b></td>
  </tr>
  <tr>
    <td valign="top">access</td>
    <td valign="top">
      List of access flags to the method separated by spaces. Must be one of
      <ul>
      <li>public</li>
      <li>protected</li>
      <li>private</li>
      <li>static</li>
      <li>synchronized</li>
      <li>native</li>
      <li>abstract</li>
      <li>strictfp</li>
      </ul>
      All access attributes may have a leading <code>!</code> to specify the
      attributes that are not set.<br>
      The access attributes may be set using the nested
      <a href="#accessTag">access tag</a>.
    </td>
    <td valign="top" align="center">No</td>
  </tr>
  <tr>
    <td valign="top">type</td>
    <td valign="top">
    Full name of the return type of the method.<br>
    Defaults to <code>void</code>
    </td>
    <td valign="top" align="center">No</td>
  </tr>
  <tr>
    <td valign="top">name</td>
    <td valign="top">
    Name of the method. Wildcards are allowed. A description of the usage
    and limitations of wildcards can be found in
    <a href="usage.html#classspecification">ProGuard usage</a>.<br>
    Defaults to <code>*</code>
    </td>
    <td valign="top" align="center">No</td>
  </tr>
</table>

<h3>keepclasssmembers</h3>

<p>
Specifies class members to be preserved, if their classes are preserved as well.
For example, you may want to keep all serialization fields and methods of
classes that implement the Serializable interface.
</p>

<h3>Parameters</h3>

<p>
Parameters are the same as the parameters of the <a href="#keep">keep</a>
nested tag.
</p>

<h3>keepclasseswithmembers</h3>

<p>
Specifies classes and class members to be preserved, on the condition that all
of the specified class members are present. For example, you may want to keep
all applications that have a main method, without having to list them
explicitly.
</p>

<h3>Parameters</h3>

<p>
Parameters are the same as the parameters of the <a href="#keep">keep</a>
nested tag.

<h3>keepnames</h3>

<p>
Specifies classes and class members whose names are to be preserved, if they
aren't removed in the shrinking phase. For example, you may want to keep all
class names of classes that implement the Serializable interface, so that the
processed code remains compatible with any originally serialized classes.
Classes that aren't used at all can still be removed.
</p>

<h3>Parameters</h3>

<p>
Parameters are the same as the parameters of the <a href="#keep">keep</a>
nested tag.
</p>

<h3>keepclassmembernames</h3>

<p>
Specifies class members whose names are to be preserved, if they aren't removed
in the shrinking phase. For example, you may want to preserve the name of the
synthetic class$ methods when processing a library, so ProGuard can detect it
again when processing an application that uses the processed library.
</p>

<h3>Parameters</h3>

<p>
Parameters are the same as the parameters of the <a href="#keep">keep</a>
nested tag.
</p>

<h3>keepclasseswithmembernames</h3>

<p>
Specifies classes and class members whose names are to be preserved, on the
condition that all of the specified class members are present after the
shrinking phase. For example, you may want to keep all native method names and
the names of their classes, so that the processed code can still link with the
native library code. Native methods that aren't used at all can still be
removed. If a class file is used, but none of its native methods are, its
name will still be obfuscated.
</p>

<h3>Parameters</h3>

<p>
Parameters are the same as the parameters of the <a href="#keep">keep</a>
nested tag.
</p>

<a name="keepattribute"></a>
<h3>keepattribute</h3>

<p>
Specifies any optional attributes to be preserved.
Only applicable when obfuscating.
</p>


<h3>Parameters</h3>

<table border="1" cellpadding="2" cellspacing="0">
  <tr>
    <td valign="top"><b>Attribute</b></td>
    <td valign="top"><b>Description</b></td>
    <td align="center" valign="top"><b>Required</b></td>
  </tr>

  <tr>
    <td valign="top">name</td>
    <td valign="top">
     Name of the attribute to keep. <code>*</code> preserves all attributes.
     Typical optional attributes are
      <ul>
      <li>LineNumberTable</li>
      <li>LocalVariableTable</li>
      <li>SourceFile</li>
      <li>Deprecated</li>
      <li>Synthetic</li>
      </ul>
      The InnerClasses attribute name can be specified as well, referring to
      the source name part of this attribute.
      For example, you could keep the Deprecated attribute when processing a
      library.
    </td>
    <td valign="top" align="center">No</td>
  </tr>
</table>

<a name="migrating"></a>
<h3>Migrating from a ProGuard configuration files to Ant build files</h3>

<p>
This section describes how you could move from using a ProGuard configuration
file to working with a full XML Ant build file, in two steps.
</p>

<h3>Continuing to use a ProGuard configuration file</h3>

<p>
The simplest way to use the ProGuard task in an Ant build file is to keep
your ProGuard configuration file, and include it from Ant. You can include
your ProGuard configuration file by setting the <a
href="#configuration">configuration</a> attribute of your
<code>proguard</code> task. Your ant build file will then look like this:
</p>

<code>
&lt;taskdef name="proguard" classname="proguard.ant.ProGuardTask" /&gt;<br>
&lt;proguard configuration="myconfigfile.pro"/&gt;
</code>

<p>
This is a convenient option if you prefer ProGuard's configuration style over
XML, if you want to keep your build file small, or if you have to share your
configuration with developers who don't use Ant.
</p>

<h3>Embedding a ProGuard configuration in the Ant build file</h3>

<p>
Another possibility is to copy the contents of the ProGuard configuration file
into the nested text of the <code>proguard</code> task (the PCDATA area). Your
Ant build file will then look like this:
</p>

<code>
&lt;taskdef name="proguard" classname="proguard.ant.ProGuardTask" /&gt;<br>
&lt;proguard&gt;<br>
&nbsp;&nbsp;&lt;!--<br>
&nbsp;&nbsp;This Ant build file illustrates how to process ProGuard itself.<br>
&nbsp;&nbsp;Configuration files for typical applications will be very similar.<br>
&nbsp;&nbsp;--&gt;<br>
<br>
&nbsp;&nbsp;-libraryjars ${java.home}/lib/rt.jar<br>
&nbsp;&nbsp;-libraryjars ${ant.lib}/ant.jar<br>
&nbsp;&nbsp;-injars      dist/proguard.jar<br>
&nbsp;&nbsp;-outjar      dist/proguard_out.jar<br>
<br>
&nbsp;&nbsp;...<br>
<br>
&nbsp;&nbsp;&lt;!-- The main seeds: ProGuard and its companion tool ReTrace. --&gt;<br>
<br>
&nbsp;&nbsp;-keep public class proguard.ProGuard {<br>
&nbsp;&nbsp;&nbsp;&nbsp;public static void main(java.lang.String[]);<br>
&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;-keep public class proguard.ReTrace {<br>
&nbsp;&nbsp;&nbsp;&nbsp;public static void main(java.lang.String[]);<br>
&nbsp;&nbsp;}<br>
&lt;/proguard&gt;<br>
</code>

<p>
Some minor syntactical changes are required in order to be conform with the XML
standard.
</p>

<p>
Firstly, the <code>#</code> char cannot be used for comments in an XML file.
Comments must be enclosed by an opening <code>&lt;--</code> and a closing
<code>--&gt;</code>. All occurrences of the <code>#</code> char in between must
be removed.
</p>

<p>
Secondly, the use of the <code>&lt;</code> and the <code>&gt;</code> characters
to mark an environment variable are would upset the structure of the XML build
file invalid. Environment variables are now enclosed by an opening
<code>${</code> and a closing <code>}</code>. This change is in line with
Ant traditions.
</p>

<p>
You can then gradually replace the text enclosed by the <code>proguard</code>
tags by task attributes or nested tasks. Mixing nested text configuration with
attributes of the <code>proguard</code> task is allowed.
</p>

<hr>
<address>
Copyright &copy; 2003 <a href="mailto:dirk.schnelle@web.de">Dirk Schnelle</a>.
</address>
</body>
</html>
